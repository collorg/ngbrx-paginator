<div *ngIf="pagination$ | async as pagination">
  <div class="row stick-to-the-top">
    <div class="col">
      <ngb-pagination
        [collectionSize]="(collection$ | async)?.length || 0"
        [(page)]="page"
        (pageChange)="changePage(page)"
        [pageSize]="pagination.pageSize"
        [boundaryLinks]="true"
      >
        <ng-template ngbPaginationPages let-page let-pages="pages">
          <li class="ngb-custom-pages-item" *ngIf="pages.length > 0">
            <div class="mb-3 d-flex flex-nowrap px-2">
              <label
                id="paginationInputLabel"
                for="paginationInput"
                class="col-form-label me-2 ms-1"
                >Page</label
              >
              <input
                #i
                type="text"
                inputmode="numeric"
                pattern="[0-9]*"
                class="form-control custom-pages-input"
                id="paginationInput"
                [value]="pagination.page"
                (keyup.enter)="setPage(i.value)"
                (blur)="setPage(i.value)"
                (input)="formatInput($any($event).target)"
                aria-labelledby="paginationInputLabel paginationDescription"
                style="width: 5rem"
              />
              <span
                id="paginationDescription"
                class="col-form-label text-nowrap px-2"
              >
                of {{ pagesCount$ | async }}</span
              >
            </div>
          </li>
        </ng-template>
      </ngb-pagination>
    </div>
    <div class="col">
      <button
        class="btn dropdown-toggle"
        id="dropdownMenuButton"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        {{ pagination.pageSize }} lines/page
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <li
          *ngFor="let pageSize of pagination.pageSizeOptions"
          class="dropdown-item"
          value="{{ pageSize }}"
          (click)="setPageSize(pageSize)"
        >
          {{ pageSize }} lines
        </li>
      </ul>
    </div>
    <div
      class="col d-flex justify-content-end"
      *ngIf="filters$ | async as filters"
    >
      <button
        type="button"
        (click)="toggleShowFilters()"
        class="btn btn-light button-32"
      >
        <ngbrx-paginator-search-icon></ngbrx-paginator-search-icon>
      </button>
    </div>
    <div *ngIf="showFilters">
      <div class="row" *ngIf="filters$ | async as filterKeys">
        <div
          *ngFor="let filterKey of filterKeys; index as filterIdx"
          class="col-auto col-md input-group"
        >
          <div
            class="input-group-text"
            (click)="toggleSelectedFilterKey(filterIdx)"
          >
            <div *ngIf="isChecked$(filterIdx) | async; else notChecked">
              <ngbrx-paginator-locked-filter></ngbrx-paginator-locked-filter>
            </div>
            <ng-template #notChecked>
              <ngbrx-paginator-unlocked-filter></ngbrx-paginator-unlocked-filter>
            </ng-template>
          </div>
          <select
            *ngIf="
              getFilterValues$(filterKey) | async as fValues;
              else noValues
            "
            (focus)="setFilterKey(filterIdx)"
            (change)="setSelectedOption($event)"
            class="form-control col-md-auto"
            [ngClass]="{ current: filterIdx === currentFilter }"
          >
            <option [selected]="filterQueries[filterIdx] === ''" value="">
              {{ filterKey }}
            </option>
            <option
              *ngFor="let value of fValues; index as valueIdx"
              [selected]="filterQueries[filterIdx] === value"
              [value]="value"
            >
              {{ value }}
            </option>
          </select>
          <ng-template #noValues>
            <input
              class="form-control col-md-auto"
              [ngClass]="{ current: filterIdx === currentFilter }"
              type="search"
              [placeholder]="filterKey"
              [value]="getFilterQuery$(filterIdx) | async"
              (focus)="setFilterKey(filterIdx)"
              (keyup)="setFilterQuery($event)"
            />
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
